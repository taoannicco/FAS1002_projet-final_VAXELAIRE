---
title: "script"
output: html_document
---

```{r - packages}
library(googlesheets4)
library(readxl)
library(lubridate)
library(magrittr)
library(tidyverse)
library(dplyr)
```

## Ce fichier permet de télécharger les données brutes mais aussi de les actualiser.

### Téléchargement données de Gapminder :

on s'intéresse plus particulièrement à l'espérance de vie par pays à travers les années, la 4ème table du google sheet :

google (mise à jour mensuelle) Il faut tout d'abord se connecter via google pour ce type de document.

```{r identification à google}
googlesheets4::gs4_find()
```

### création de la première date comme référence (à ne pas refaire)

on crée un premier moi de référence et une première année de référence **Une fois fait, il ne faut JAMAIS répéter cette action.**

```{r}
date_ref <- Sys.Date()
mois_ref <- month(date_ref)
an_ref <- year(date_ref)
jour_ref <- day(date_ref)
```

### création d'une variable donnant le mois :

```{r}
today <- Sys.Date()
date <- today
mois <- month(date)
an <- year(date)
```

```{r}
getwd()
file.create("/Users/nicolasvaxelaire/FAS1002_projet-final/data/raw/data_life.csv")


data_life <- download.file(url = "https://docs.google.com/spreadsheets/d/1RheSon1-q4vFc3AGyupVPH6ptEByE-VtnjOCselU0PE/edit#gid=176703676", destfile = "data_frame.csv", method = 'auto')

```


```{r}
if (mois != mois_ref) {    #téléchargement pour tous les mois sauf celui de référénce
    data_life <- read_sheet("https://docs.google.com/spreadsheets/d/1RheSon1-q4vFc3AGyupVPH6ptEByE-VtnjOCselU0PE/edit#gid=176703676", sheet = 4)
    
    mois_ref <- mois # le mois de rééférence devient le mois actuel
    print("Les données sont à jour") 
    } else if (an != an_ref) { #téléchargement pour les prochains mois de décembre
    data_life <- read_sheet("https://docs.google.com/spreadsheets/d/1RheSon1-q4vFc3AGyupVPH6ptEByE-VtnjOCselU0PE/edit#gid=176703676", sheet = 4)
    print("Les données sont à jour") 
    } else { 
    print("Les données sont déjà à jour") 
}

    

```

## Téléchargement données de Our world in data (mise à jour quotidienne)

### Energy

sur github en CSV

```{r}
jour <- day(today)

if (jour != jour_ref) {    #téléchargement pour tous les mois sauf celui de référénce
    data_energy <- read.csv("https://nyc3.digitaloceanspaces.com/owid-public/data/energy/owid-energy-data.csv")
    jour_ref <- jour # le mois de rééférence devient le mois actuel
    print("Les données sont à jour.") 
    } else if (an != an_ref) { #téléchargement pour les prochains mois de décembre
    data_energy <- read.csv("https://nyc3.digitaloceanspaces.com/owid-public/data/energy/owid-energy-data.csv")
    print("Les données sont à jour") 
    } else { 
    print("Les données sont déjà à jour") 
    }


```

### CO2 :

sur github en CSV

```{r}
jour <- day(today)

if (jour != jour_ref) {    #téléchargement pour tous les mois sauf celui de référénce
    data_carbon <- read.csv("https://nyc3.digitaloceanspaces.com/owid-public/data/co2/owid-co2-data.csv")
    jour_ref <- jour # le mois de rééférence devient le mois actuel
    print("Les données sont à jour.") 
    } else if (an != an_ref) { #téléchargement pour les prochains mois de décembre
    data_carbon <- read.csv("https://nyc3.digitaloceanspaces.com/owid-public/data/co2/owid-co2-data.csv")
    print("Les données sont à jour") 
    } else { 
    print("Les données sont déjà à jour") 
    }

```



@Manual{
    title  {googlesheets4: Access Google Sheets using the Sheets API V4},
    author = {Jennifer Bryan},
    year = {2022},
    note = {R package version 1.0.1},
    url = {https://CRAN.R-project.org/package=googlesheets4},
}

@Manual{,
    title = {readxl: Read Excel Files},
    author = {Hadley Wickham and Jennifer Bryan},
    year = {2022},
    note = {R package version 1.4.1},
    url = {https://CRAN.R-project.org/package=readxl},
}
  
@Article{,
    title = {Dates and Times Made Easy with {lubridate}},
    author = {Garrett Grolemund and Hadley Wickham},
    journal = {Journal of Statistical Software},
    year = {2011},
    volume = {40},
    number = {3},
    pages = {1--25},
    url = {https://www.jstatsoft.org/v40/i03/},
}

@Manual{,
    title = {magrittr: A Forward-Pipe Operator for R},
    author = {Stefan Milton Bache and Hadley Wickham},
    year = {2022},
    note = {R package version 2.0.3},
    url = {https://CRAN.R-project.org/package=magrittr},
}

@Manual{,
    title = {dplyr: A Grammar of Data Manipulation},
    author = {Hadley Wickham and Romain François and Lionel Henry and Kirill Müller},
    year = {2022},
    note = {R package version 1.0.10},
    url = {https://CRAN.R-project.org/package=dplyr},
}

@Manual{,
    title = {gapminder: Data from Gapminder},
    author = {Jennifer Bryan},
    year = {2017},
    note = {R package version 0.3.0},
    url = {https://CRAN.R-project.org/package=gapminder},
}

@Article{,
    title = {Welcome to the {tidyverse}},
    author = {Hadley Wickham and Mara Averick and Jennifer Bryan and Winston Chang and Lucy D'Agostino McGowan and Romain François and Garrett Grolemund and Alex Hayes and Lionel Henry and Jim Hester and Max Kuhn and Thomas Lin Pedersen and Evan Miller and Stephan Milton Bache and Kirill Müller and Jeroen Ooms and David Robinson and Dana Paige Seidel and Vitalie Spinu and Kohske Takahashi and Davis Vaughan and Claus Wilke and Kara Woo and Hiroaki Yutani},
    year = {2019},
    journal = {Journal of Open Source Software},
    volume = {4},
    number = {43},
    pages = {1686},
    doi = {10.21105/joss.01686},
}

